<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>IDE Container: Rstudio, Shiny Server, and More &bull; sevenbridges</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sevenbridges</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>IDE Container: Rstudio, Shiny Server, and More</h1>
            
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h2>
<p>The goal of this <code>tengfei/sevenbridges</code> Docker image is to provide</p>
<ul><li>SDK environment that includes
<ul><li>Command line uploader</li>
<li>Seven Bridgs Command line tools</li>
<li>sevenbridges R package</li>
</ul></li>
<li>Rstudio server</li>
<li>Shiny server</li>
</ul></div>
<div id="docker-container" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#docker-container" class="anchor"> </a></body></html>Docker container</h2>
<div id="build-container-locally" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#build-container-locally" class="anchor"> </a></body></html>Build container locally</h3>
<p>The <code>Dockerfile</code> is included with the package in <code>inst/docker</code> folder.</p>
<p>Here is the current content of <code>Dockerfile</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fl =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"docker/sevenbridges/"</span>, <span class="st">"Dockerfile"</span>, <span class="dt">package =</span> <span class="st">"sevenbridges"</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(fl), <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>FROM rocker/hadleyverse
MAINTAINER "Tengfei Yin" yintengfei@gmail.com

## install docker (docker in docker)
RUN apt-get update &amp;&amp; apt-get install -y  \
    sudo \
    gdebi-core \
    pandoc \
    pandoc-citeproc \
    libcurl4-gnutls-dev \
    curl \
    libcairo2-dev \
    libxt-dev \
    unp \
    emacs \
    supervisor \
    libfuse-dev
##     aufs-tools \
##     cgroupfs-mount

# RUN wget --no-verbose http://ftp.us.debian.org/debian/pool/main/l/lvm2/libdevmapper1.02.1_1.02.136-1_amd64.deb &amp;&amp; \
#    dpkg -i libdevmapper1.02.1_1.02.136-1_amd64.deb &amp;&amp; \
#    rm -f libdevmapper1.02.1_1.02.136-1_amd64.deb

# RUN wget --no-verbose http://ftp.us.debian.org/debian/pool/main/libt/libtool/libltdl7_2.4.6-2_amd64.deb &amp;&amp; \
#    dpkg -i libltdl7_2.4.6-2_amd64.deb &amp;&amp; \
#    rm -f libltdl7_2.4.6-2_amd64.deb

## install docker
RUN apt-get install -y apt-transport-https ca-certificates \
    &amp;&amp; apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D \
    &amp;&amp; echo "deb https://apt.dockerproject.org/repo debian-jessie main" &gt; /etc/apt/sources.list.d/docker.list \
    &amp;&amp; echo "//APT::Default-Release \"testing\";" &gt; /etc/apt/apt.conf.d/default   \
    &amp;&amp; apt-cache policy docker-engine

Run apt-get update -y \
    &amp;&amp; apt-get upgrade -y \
    &amp;&amp; apt-get install -y docker-engine



####################
### addin
###################

RUN R -e "install.packages(c('rstudioapi', 'miniUI'), type = 'source'); "


##################
### Bioc
#################

## install from github instead of bioc for latest version
RUN Rscript -e "source('http://bioconductor.org/biocLite.R');\
    devtools::install_github('sbg/sevenbridges-r', build_vignettes=FALSE, repos=BiocInstaller::biocinstallRepos(),  dependencies=TRUE)"

## RUN Rscript -e 'source("http://bioconductor.org/biocLite.R");library(BiocInstaller); ## biocLite("sevenbridges", dep = TRUE)'




##################
### SBG
#################

## install SBG Command line uploader
## RUN wget https://igor.sbgenomics.com/sbg-uploader/sbg-uploader.tgz \
##     &amp;&amp; tar zxvf sbg-uploader.tgz -C / \
##    &amp;&amp; ln -s  /sbg-uploader/bin/sbg-uploader.sh /usr/local/bin/sbg-uploader.sh


## install SBG rabix
RUN wget https://github.com/rabix/bunny/releases/download/v0.1.0-alpha/rabix-0.1.1-alpha.tar.gz \
    &amp;&amp; tar -zvxf rabix-0.1.1-alpha.tar.gz \
    &amp;&amp; ln -s  /rabix-0.1.1-alpha/rabix.sh /usr/local/bin/rabix.sh


## install SBG Command line uploader
## RUN wget https://cgc.sbgenomics.com/cgc-uploader/cgc-uploader.tgz \
##    &amp;&amp; tar zxvf cgc-uploader.tgz -C / \
##    &amp;&amp; ln -s  /cgc-uploader/bin/cgc-uploader.sh /usr/local/bin/cgc-uploader.sh

## start insert command line interface and report template needed
ADD src/runif.R /usr/local/bin/
RUN mkdir /report/
ADD report/report.Rmd /report/






## liftr
RUN R -e "devtools::install_github('road2stat/liftr', ref = 'devel')"
RUN R -e "devtools::install_github('rstudio/packrat')"



## (because --deps TRUE can fail when packages are added/removed from CRAN)
RUN rm -rf /var/lib/apt/lists/ \
    &amp;&amp; rm -rf /tmp/downloaded_packages/ /tmp/*.rds


####################
### shiny
###################

## thanks to official shiny docker file

# Download and install libssl 0.9.8
RUN wget --no-verbose http://security.debian.org/debian-security/pool/updates/main/o/openssl/libssl1.0.0_1.0.1t-1+deb8u5_amd64.deb &amp;&amp; \
   dpkg -i libssl1.0.0_1.0.1t-1+deb8u5_amd64.deb &amp;&amp; \
   rm -f libssl1.0.0_1.0.1t-1+deb8u5_amd64.deb

# Download and install shiny server
RUN wget --no-verbose https://s3.amazonaws.com/rstudio-shiny-server-os-build/ubuntu-12.04/x86_64/VERSION -O "version.txt" &amp;&amp; \
    VERSION=$(cat version.txt)  &amp;&amp; \
    wget --no-verbose "https://s3.amazonaws.com/rstudio-shiny-server-os-build/ubuntu-12.04/x86_64/shiny-server-$VERSION-amd64.deb" -O ss-latest.deb &amp;&amp; \
    gdebi -n ss-latest.deb &amp;&amp; \
    rm -f version.txt ss-latest.deb

RUN R -e "install.packages(c('shiny', 'rmarkdown'), repos='https://cran.rstudio.com/')"

RUN R -e "devtools::install_github('rstudio/addinexamples', type = 'source')"

RUN R -e "devtools::install_github('rstudio/rsconnect')"

RUN R -e "devtools::install_github('rstudio/shinyapps')"

RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* /srv/shiny-server/

RUN mkdir /home/rstudio/ShinyApps/

RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* /home/rstudio/ShinyApps/

EXPOSE 3838 8787

## COPY src/shiny-server.sh /usr/bin/shiny-server.sh
# RUN wget --no-verbos https://raw.githubusercontent.com/sbg/sevenbridges-r/master/inst/docker/sevenbridges/src/shiny-server.conf -P /etc/shiny-server/
# RUN wget --no-verbos https://raw.githubusercontent.com/sbg/sevenbridges-r/master/inst/docker/sevenbridges/src/supervisord.conf    -P /etc/shiny-server/
COPY src/shiny-server.conf  /etc/shiny-server/shiny-server.conf
COPY src/supervisord.conf /etc/supervisor/conf.d/supervisord.conf

## ~/ShinyApps
## RUN yes | /opt/shiny-server/bin/deploy-example user-dirs
## RUN cp -R /usr/local/lib/R/site-library/shiny/examples/* ~/ShinyApps/

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
## CMD ["/init;/usr/bin/shiny-server.sh"]
## CMD ["sh", "-c", "/usr/bin/shiny-server.sh;/init"]</code></pre>
<p>You can simply build it locally, enter folder which contain that <code>Dockerfile</code>, in this case, it&rsquo;s under <code>inst/docker/sevenbridges</code></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker</span> build -t tengfei/sevenbridges .</code></pre></div>
</div>
<div id="pull-from-docker-hub" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#pull-from-docker-hub" class="anchor"> </a></body></html>Pull from Docker Hub</h3>
<p>A hook is added to build the Docker image automatically from the <a href="https://github.com/sbg/sevenbridges-r/tree/master/inst/docker/sevenbridges">sevenbridges-r GitHub repository</a>. It is automatically built on <a href="https://hub.docker.com/r/tengfei/sevenbridges/">Docker Hub</a>. You can directly use this image <code>tengfei/sevenbridges</code>. Everytime a push is made in the GitHub repo, the Docker container is re-built.</p>
</div>
</div>
<div id="launch-rstudio-server-from-docker-container" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#launch-rstudio-server-from-docker-container" class="anchor"> </a></body></html>Launch Rstudio server from Docker container</h2>
<p>For example, you can ssh into your AWS instance, here I suppose you already have Docker installed, and pull the image</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker</span> pull tengfei/sevenbridges</code></pre></div>
<p>To launch sevenbridges Rstudio server image, I recommend you read this <a href="https://github.com/rocker-org/rocker/wiki/Using-the-RStudio-image">tutorial</a></p>
<p>Or following the quick instruction here</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker</span> run -d -p 8787:8787 tengfei/sevenbridges
<span class="ex">docker</span> run -d -p 8787:8787 -e USER=<span class="op">&lt;</span>username<span class="op">&gt;</span> -e PASSWORD=<span class="op">&lt;</span>password<span class="op">&gt;</span> rocker/rstudio</code></pre></div>
<p>You will be able to access the Rstudio in the browser by something like</p>
<p><code>http://&lt;your ip address&gt;:8787</code></p>
<p>Sometimes you want to add more users, to add users</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## Enter the container</span>
<span class="ex">docker</span> exec -it <span class="op">&lt;</span>container-id<span class="op">&gt;</span> bash
<span class="co">## Interactively input password and everything else</span>
<span class="ex">adduser</span> <span class="op">&lt;</span>username<span class="op">&gt;</span></code></pre></div>
<div id="launch-both-rstudio-and-shiny-server-from-the-same-docker-container" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#launch-both-rstudio-and-shiny-server-from-the-same-docker-container" class="anchor"> </a></body></html>Launch both Rstudio and Shiny server from the same Docker container</h3>
<p>Sometimes it&rsquo;s very conventient to launch both Rstudio and Shiny server from a singel container and your users can manage to using Rstudio and publish Shiny apps at the same time in the same container. To do so, just pull the same image and launch them at different port.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker</span> run  -d -p 8787:8787 -p 3838:3838 --name rstudio_shiny_server tengfei/sevenbridges</code></pre></div>
<p>To mount file system you need to use <code>--privileged</code> with fuse.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker</span> run  --privileged -d -p 8787:8787 -p 3838:3838 --name rstudio_shiny_server tengfei/sevenbridges</code></pre></div>
<p>check out the ip from docker machine if you are on mac os.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">docker-machine</span> ip default</code></pre></div>
<p>In your browser, <code>http://&lt;url&gt;:8787/</code> for Rstudio server, for example, if 192.168.99.100 is what returned, visit <code>http://192.168.99.100:8787/</code> for Rstudio.</p>
<p>For shiny server, <strong>per user app</strong> is hosted <code>http://&lt;url&gt;:3838/users/&lt;username of rstudio&gt;/&lt;app_dir&gt;</code>, for example, for user <code>rstudio</code> (a default user) and an app called <code>01_hello</code>, it will be <code>http://&lt;url&gt;:3838/users/rstudio/01_hello/</code>. To develop your shiny app from Rstudio server, you can login your rstudio server with your username, and create a fold at home folder called <code>~/ShinyApps</code> and develop shiny apps under that folder, for example, you can create an app called <code>02_text</code> at <code>~/ShinyApps/02_text/</code>.</p>
<p>Let&rsquo;s try this, please login your rstudio at <code>http://&lt;url&gt;:8787</code> now, then try to copy some example over to your home folder under <code>~/ShinyApps/</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dir.create</span>(<span class="st">"~/ShinyApps"</span>)
<span class="kw">file.copy</span>(<span class="st">"/usr/local/lib/R/site-library/shiny/examples/01_hello/"</span>,
          <span class="st">"~/ShinyApps/"</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>If you logged in with the username <code>rstudio</code>, then visit <code>http://192.168.99.100:3838/rstudio/01_hello</code> you should be able to see the hello example.</p>
<p>Note: Generic shiny apps can also be hosted <code>http://&lt;url&gt;:3838/</code> or for particular app, <code>http://&lt;url&gt;:3838/&lt;app_dir&gt;</code> and inside the Docker container, it&rsquo;s hosted under <code>/srv/shiny-server/</code>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#introduction">Introduction</a></li>
      <li><a href="#docker-container">Docker container</a></li>
      <li><a href="#launch-rstudio-server-from-docker-container">Launch Rstudio server from Docker container</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nan Xiao, Dusan Randjelovic, Tengfei Yin, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
